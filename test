import LoginPage from '../../support/pages/LoginPage';
import DashboardPage from '../../support/pages/DashboardPage';
import TransferPage from '../../support/pages/TransferPage';

describe('Virements entre comptes propres', () => {
    const loginPage = new LoginPage();
    const dashboardPage = new DashboardPage();
    const transferPage = new TransferPage();

    beforeEach(() => {
        cy.fixture('users').as('usersData'); // charger la fixture
        cy.visit('http://127.0.0.1:8080/index.html'); // page de connexion
    });

    it('Doit effectuer un virement du compte courant vers le Livret A', function () {
        const user = this.usersData.balanceUser;
        const transferAmount = user.transfer.amount; // montant depuis la fixture

      
        // Connexion
       
        loginPage.login(user.email, user.password);

        // V√©rification message de bienvenue
        dashboardPage.verifyGreeting('Utilisateur üëã');

       
        // Aller sur l'onglet Virements
      
        transferPage.transferTab().click();

        // V√©rifier qu'on est sur la page de virement
        transferPage.transferTitle().should('be.visible');

        
        // Effectuer le virement
        
        transferPage.makeTransfer(
            'Compte Courant - 5 000,00 ‚Ç¨',  // compte d√©biteur
            'Livret A - 15 000,00 ‚Ç¨',       // compte cr√©diteur
            transferAmount                   // montant depuis la fixture
        );

         // V√©rifier le message de succ√®s
        cy.get('#transfer-success') 
            .should('not.have.class', 'hidden')  // V√©rifier que la classe 'hidden' a disparu
            .and('contain.text', 'Virement effectu√© avec succ√®s !'); // V√©rifier que le texte est correct

    });
});
 